{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4 d-flex justify-content-center">
  <div style="width:100%; max-width:1100px;">

    <!-- sticky header / toolbar -->
    <div class="d-flex flex-wrap justify-content-between align-items-start mb-3"
         style="position:sticky; top:0; z-index:10; background:#f8f9fa; padding:.5rem 0; border-bottom:1px solid #dee2e6;">
      <div class="me-3">
        <div class="fw-semibold text-uppercase" style="font-size:1rem; letter-spacing:.03em; line-height:1.2;">
          Change Password
        </div>
        <div class="text-muted" style="font-size:.8rem; line-height:1.2;">
          {{ user.username }}
        </div>
      </div>

      <div class="d-flex flex-column flex-sm-row gap-2 mt-2 mt-sm-0">
        <a href="{{ url_for('inventory.dashboard') }}"
           class="btn btn-outline-secondary btn-sm shadow-sm"
           style="font-weight:500; min-width:140px; border-radius:.6rem;">
          ‚Üê Back to Dashboard
        </a>
      </div>
    </div>

    <!-- card -->
    <div class="d-flex justify-content-center">
      <div class="card shadow-sm border-0"
           style="max-width:480px; width:100%; border-radius:1rem; background:linear-gradient(#ffffff,#fdfdfd); box-shadow:0 .5rem 1rem rgba(0,0,0,.07)!important;">
        <div class="card-header bg-white border-0"
             style="border-radius:1rem 1rem 0 0; border-bottom:1px solid #dee2e6;">
          <div class="fw-semibold text-uppercase"
               style="font-size:.8rem; letter-spacing:.05em; color:#6c757d;">
            Update Credentials
          </div>
          <div class="text-muted" style="font-size:.7rem; line-height:1.2;">
            New password will take effect immediately
          </div>
        </div>

        <div class="card-body">
          <form method="POST" autocomplete="off">

            {# USER changing own password -> MUST confirm current password #}
            {% if need_current %}
            <div class="mb-3">
              <label for="current_password"
                     class="form-label fw-semibold mb-1"
                     style="font-size:.8rem; text-transform:uppercase; letter-spacing:.05em;">
                Current Password
              </label>
              <input
                type="password"
                class="form-control form-control-sm"
                id="current_password"
                name="current_password"
                required
                autocomplete="current-password"
                style="border-radius:.6rem; font-size:.9rem;">
              <div class="form-text" style="font-size:.7rem; line-height:1.2;">
                Security check so nobody else can change your password.
              </div>
            </div>
            {% endif %}

            <div class="mb-3">
              <label for="password"
                     class="form-label fw-semibold mb-1"
                     style="font-size:.8rem; text-transform:uppercase; letter-spacing:.05em;">
                New Password
              </label>
              <input
                type="password"
                class="form-control form-control-sm"
                id="password"
                name="password"
                required
                autocomplete="new-password"
                style="border-radius:.6rem; font-size:.9rem;">
              <div class="form-text" style="font-size:.7rem; line-height:1.2;">
                Minimum 8 characters (recommended)
              </div>
            </div>

            <div class="mb-4">
              <label for="confirm_password"
                     class="form-label fw-semibold mb-1"
                     style="font-size:.8rem; text-transform:uppercase; letter-spacing:.05em;">
                Confirm New Password
              </label>
              <input
                type="password"
                class="form-control form-control-sm"
                id="confirm_password"
                name="confirm_password"
                required
                autocomplete="new-password"
                style="border-radius:.6rem; font-size:.9rem;">
              <div class="form-text" style="font-size:.7rem; line-height:1.2;">
                Type it again to avoid typos
              </div>
            </div>

            <div class="d-grid gap-2">
              <button type="submit"
                      class="btn btn-primary shadow-sm"
                      style="font-weight:600; border-radius:.8rem; padding:.6rem 1rem; font-size:.9rem; box-shadow:0 .5rem 1rem rgba(13,110,253,.35)!important;">
                üîê Change Password
              </button>

              <a href="{{ url_for('inventory.dashboard') }}"
                 class="btn btn-outline-secondary shadow-sm"
                 style="font-weight:500; border-radius:.8rem; padding:.6rem 1rem; font-size:.9rem;">
                ‚Üê Cancel / Back
              </a>
            </div>

          </form>
        </div>

        <div class="card-footer bg-white text-muted"
             style="font-size:.7rem; line-height:1.2; border-top:1px solid #dee2e6;">
          If this is not your account and you're an admin resetting someone else‚Äôs password,
          you do NOT need their current password.
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}
