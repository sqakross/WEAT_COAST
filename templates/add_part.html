{% extends "base.html" %}

{% block content %}
<h2>Add or Update Part</h2>

<form method="POST" action="{{ url_for('inventory.add_part') }}">
    <label for="part_number">Part Number:</label>
    <input type="text" name="part_number" id="part_number" required style="text-transform: uppercase;">

    <label for="name">Part Name:</label>
    <input type="text" name="name" id="name" required>

    <label for="quantity">Quantity:</label>
    <input type="number" name="quantity" min="1" required>

    <label for="unit_cost">Unit Cost:</label>
    <input type="number" step="0.01" name="unit_cost" id="unit_cost" required>

    <label for="location">Location (Shelf):</label>
    <input type="text" name="location" id="location" required>

    <button type="submit">Add / Update Part</button>
   <a href="{{ url_for('inventory.dashboard') }}" class="btn btn-secondary mb-3">‚Üê Back to Dashboard</a>

</form>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const partNumberInput = document.getElementById('part_number');
    const nameInput = document.getElementById('name');
    const unitCostInput = document.getElementById('unit_cost');
    const locationInput = document.getElementById('location');

    partNumberInput.addEventListener("blur", async function () {
        const partNumber = partNumberInput.value.trim().toUpperCase();
        partNumberInput.value = partNumber;

        if (partNumber) {
            try {
                const response = await fetch(`/api/part/${partNumber}`);
                if (!response.ok) throw new Error("Not found");
                const data = await response.json();

                nameInput.value = data.name || '';
                unitCostInput.value = data.unit_cost !== undefined ? data.unit_cost : '';
                locationInput.value = data.location || '';
            } catch (err) {
                nameInput.value = '';
                unitCostInput.value = '';
                locationInput.value = '';
            }
        }
    });
});
</script>
{% endblock %}

